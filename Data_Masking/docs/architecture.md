# 项目架构

本文档详细介绍法律文档脱敏工具的系统架构设计和模块组织。

## 系统架构

法律文档脱敏工具采用模块化设计，主要由以下几个核心模块组成：

1. **NER模型模块**：负责识别文本中的敏感实体
2. **脱敏策略模块**：提供多种脱敏策略实现
3. **数据脱敏器模块**：负责文本脱敏和恢复
4. **文档脱敏器模块**：负责处理整个文档的脱敏和恢复
5. **Web界面模块**：提供用户友好的操作界面

### 架构图

```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|   Web界面模块    |---->|   文档脱敏器    |---->|   数据脱敏器    |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
                                                          |
                                                          v
                                           +------------------+     +------------------+
                                           |                  |     |                  |
                                           |   脱敏策略模块   |<----|   NER模型模块   |
                                           |                  |     |                  |
                                           +------------------+     +------------------+
```

## 模块组织

项目采用包结构组织代码，主要包括以下几个包：

```
Data_Masking/
├── __init__.py          # 包初始化文件
├── NER_model.py         # NER模型相关功能
├── strategies/          # 脱敏策略模块
│   ├── __init__.py
│   ├── base_strategy.py           # 策略基类
│   ├── type_based_strategy.py     # 基于类型的策略
│   ├── context_aware_strategy.py  # 上下文感知策略
│   ├── custom_replacement_strategy.py  # 自定义替换策略
│   ├── hash_strategy.py           # 哈希策略
│   └── replacement_strategy.py    # 替换策略
├── maskers/             # 脱敏器模块
│   ├── __init__.py
│   ├── data_masker.py             # 数据脱敏器
│   └── document_masker.py         # 文档脱敏器
└── ui/                  # Web界面模块
    ├── __init__.py
    ├── app.py                     # Flask应用
    ├── templates/                 # HTML模板
    │   ├── index.html             # 首页
    │   ├── result.html            # 脱敏结果页
    │   └── unmasked_result.html   # 恢复结果页
    ├── maps/                      # 映射表存储目录
    ├── output/                    # 输出文件存储目录
    └── uploads/                   # 上传文件存储目录
```

## 数据流

系统的数据流如下：

1. **文档上传**：用户通过Web界面上传文档
2. **文档解析**：系统解析文档，提取文本内容
3. **实体识别**：使用NER模型识别文本中的敏感实体
4. **脱敏处理**：根据配置的脱敏策略，对敏感实体进行替换
5. **结果展示**：将脱敏后的文档展示给用户，并提供下载功能
6. **恢复处理**（可选）：根据保存的映射关系，恢复脱敏后的文档

### 脱敏流程图

```
+-------------+     +-------------+     +-------------+     +-------------+
|             |     |             |     |             |     |             |
| 文档上传    |---->| 文档解析    |---->| 实体识别    |---->| 脱敏处理    |
|             |     |             |     |             |     |             |
+-------------+     +-------------+     +-------------+     +-------------+
                                                                  |
                                                                  v
                                                           +-------------+
                                                           |             |
                                                           | 结果展示    |
                                                           |             |
                                                           +-------------+
                                                                  ^
                                                                  |
                                                           +-------------+
                                                           |             |
                                                           | 恢复处理    |
                                                           | （可选）    |
                                                           +-------------+
```

## 依赖关系

系统的主要依赖关系如下：

1. **NER模型模块**：依赖ModelScope NLP RANER 中文命名实体识别模型
2. **脱敏策略模块**：依赖基础策略接口，各种策略实现相互独立
3. **数据脱敏器模块**：依赖NER模型模块和脱敏策略模块
4. **文档脱敏器模块**：依赖数据脱敏器模块
5. **Web界面模块**：依赖Flask框架和文档脱敏器模块

## 扩展性设计

系统设计考虑了良好的扩展性，主要体现在以下几个方面：

1. **策略模式**：采用策略模式设计脱敏策略，便于添加新的脱敏策略
2. **模块化设计**：各个模块职责明确，相互独立，便于维护和扩展
3. **接口设计**：提供清晰的接口，便于与其他系统集成
4. **配置化**：支持通过配置文件或Web界面配置系统行为，无需修改代码

## 安全性考虑

系统在设计时考虑了以下安全性因素：

1. **数据安全**：敏感数据只在本地处理，不会上传到云端
2. **映射表安全**：映射表使用pickle序列化，存储在本地文件系统
3. **文件上传安全**：限制上传文件类型，防止恶意文件上传
4. **错误处理**：完善的错误处理机制，防止系统崩溃和信息泄露